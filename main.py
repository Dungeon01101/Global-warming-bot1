# –∏–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫
import telebot

from config import *
from telebot import types
from weather import *

# "–∞–∫—Ç–∏–≤–∞—Ü–∏—è" –±–æ—Ç–∞
bot = telebot.TeleBot(TOKEN)

# —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ –∫–æ–º–∞–Ω–¥—É /start
@bot.message_handler(commands=['start'])
def start(message):
	sti = open('components/image.jpg', 'rb')
	bot.send_photo(message.chat.id, sti)

	# –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
	markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
	item1 = types.KeyboardButton("–ü–æ—á–µ–º—É?üßê")
	item2 = types.KeyboardButton("–ö–∞–∫ —è –ø–æ–º–æ–≥—É?üßê")
	item3 = types.KeyboardButton("–ù–∞–∑–æ–≤–∏ –ø–æ–≥–æ–¥—É –≤ –º–æ—ë–º –≥–æ—Ä–æ–¥–µüå•")

	markup.add(item1, item2, item3)

	bot.send_message(message.chat.id, '–ü—Ä–∏–≤–µ—Ç, {0.first_name}!\n–Ø - {1.first_name}, –±–æ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã–π —á—Ç–æ –±—ã –æ–±—ä—è—Å–Ω–∏—Ç—å —Ç–µ–º—É –∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –≥–ª–æ–±–∞–ª—å–Ω–æ–º –ø–æ—Ç–µ–ø–ª–µ–Ω–∏–∏.'.format(message.from_user, bot.get_me()),
		parse_mode='html', reply_markup=markup)

# —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ –æ—Ç–≤–µ—Ç
@bot.message_handler(content_types=['text'])
def answer(message):
	if message.chat.type == 'private':
		if message.text == '–ù–∞–∑–æ–≤–∏ –ø–æ–≥–æ–¥—É –≤ –º–æ—ë–º –≥–æ—Ä–æ–¥–µüå•':
			# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
			def process_reply(message):
				try:
					bot.send_message(message.chat.id, temperature_w(message.text))
				except pyowm.commons.exceptions.TimeoutError:
					bot.send_message(message.chat.id, '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é —Å–µ–π—á–∞—Å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏–∑-–∑–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –Ω–µ–ø–æ–ª–∞–¥–æ–∫‚òπÔ∏è')	
				except Exception as a:
					print(repr(a))
					bot.send_message(message.chat.id, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –Ω–∞–ø–∏—à–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥')		
			bot.send_message(message.chat.id, '–ù–∞–∑–æ–≤–∏—Ç–µ –≤–∞—à –≥–æ—Ä–æ–¥')
			bot.register_next_step_handler(message, process_reply)
			
		elif message.text == '–ü–æ—á–µ–º—É?üßê':
			markup = types.InlineKeyboardMarkup(row_width=1)
			item1 = types.InlineKeyboardButton("–†–∞—Å—Å–∫–∞–∂–∏ –±–æ–ª—å—à–µ", callback_data='more')

			markup.add(item1)

			bot.send_message(message.chat.id, '–ò—Å–∫–æ–ø–∞–µ–º—ã–µ –≤–∏–¥—ã —Ç–æ–ø–ª–∏–≤–∞ ‚Äî —É–≥–æ–ª—å, –Ω–µ—Ñ—Ç—å –∏ –≥–∞–∑ ‚Äî –≤–Ω–æ—Å—è—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π –≤–∫–ª–∞–¥ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞: –Ω–∞ –∏—Ö –¥–æ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Å–≤—ã—à–µ 75 –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –≤—ã–±—Ä–æ—Å–æ–≤ –ø–∞—Ä–Ω–∏–∫–æ–≤—ã—Ö –≥–∞–∑–æ–≤ –∏ –ø–æ—á—Ç–∏ 90 –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—Å–µ—Ö –≤—ã–±—Ä–æ—Å–æ–≤ —É–≥–ª–µ–∫–∏—Å–ª–æ–≥–æ –≥–∞–∑–∞.',
				reply_markup=markup)

		elif message.text == '–ö–∞–∫ —è –ø–æ–º–æ–≥—É?üßê':
			bot.send_message(message.chat.id, '1) –ß–∞—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º \n2) –≠–∫–æ–Ω–æ–º–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é \n3) –°–æ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –º—è—Å–∞ \n4) –£—Ç–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ö–æ–¥—ã, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ç–æ—Ä—Å—ã—Ä—å–µ, –¥–∞–∂–µ –≤–æ–¥—É \n5) –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∏ –æ–±—É—á–∞—Ç—å')

		else:
			bot.send_message(message.chat.id, '–ò–∑–≤–∏–Ω–∏—Ç–µ, —è –Ω–µ –ø–æ–Ω—è–ª‚òπÔ∏è')	

# —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è "–º–∏–Ω–∏-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã" –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
@bot.callback_query_handler(func=lambda call: True)
def callback_inline(call):
	try:
		if call.message:
			if call.data == 'more':
				bot.send_message(call.message.chat.id, '–ò—Å–∫–æ–ø–∞–µ–º—ã–µ –≤–∏–¥—ã —Ç–æ–ø–ª–∏–≤–∞ ‚Äî —É–≥–æ–ª—å, –Ω–µ—Ñ—Ç—å –∏ –≥–∞–∑ ‚Äî –≤–Ω–æ—Å—è—Ç –Ω–∞–∏–±–æ–ª—å—à–∏–π –≤–∫–ª–∞–¥ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∏–º–∞—Ç–∞: –Ω–∞ –∏—Ö –¥–æ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Å–≤—ã—à–µ 75 –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –≤—ã–±—Ä–æ—Å–æ–≤ –ø–∞—Ä–Ω–∏–∫–æ–≤—ã—Ö –≥–∞–∑–æ–≤ –∏ –ø–æ—á—Ç–∏ 90 –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –≤—Å–µ—Ö –≤—ã–±—Ä–æ—Å–æ–≤ —É–≥–ª–µ–∫–∏—Å–ª–æ–≥–æ –≥–∞–∑–∞.')
				bot.send_message(call.message.chat.id, '–ü–æ–∫—Ä—ã–≤–∞—è –ó–µ–º–ª—é, –≤—ã–±—Ä–æ—Å—ã –ø–∞—Ä–Ω–∏–∫–æ–≤—ã—Ö –≥–∞–∑–æ–≤ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å–æ–ª–Ω–µ—á–Ω–æ–µ —Ç–µ–ø–ª–æ. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É –ø–æ—Ç–µ–ø–ª–µ–Ω–∏—é –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—é –∫–ª–∏–º–∞—Ç–∞. –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è –ø–ª–∞–Ω–µ—Ç–∞ –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –∫–æ–≥–¥–∞-–ª–∏–±–æ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞. –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –º–µ–Ω—è–µ—Ç –ø–æ–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –∏ –Ω–∞—Ä—É—à–∞–µ—Ç –æ–±—ã—á–Ω—ã–π –ø—Ä–∏—Ä–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å. –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∏—Å–∫–æ–≤ –¥–ª—è –ª—é–¥–µ–π –∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º –∂–∏–∑–Ω–∏ –Ω–∞ –ó–µ–º–ª–µ.')
			
			bot.edit_message_text(chat_id=call.message.chat.id, message_id=call.message.message_id, text='–ü–æ—á–µ–º—É?üßê',
				reply_markup=None)

	except Exception as e:
		print(repr(e))

# –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling(none_stop=True)	
